@tailwind base;
@tailwind components;
@tailwind utilities;

/* Reset any potential borders */
*, *::before, *::after {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* Ensure no borders on main containers */
html, body, .site-frame, .em, main, aside, article {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

/* Import token system */
@import '../styles/tokens.css';
@import '../styles/type.css';

/* Base styles */
html, body {
  margin: 0;
  padding: 0;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  background: #f5f3f0;
}

body {
  font-family: var(--font-sans);
  color: var(--ink);
}

/* Utility classes */
.bg-paper { 
  background-color: #f5f3f0 !important; 
  background: #f5f3f0 !important;
}

/* Ensure paper background is applied to main content */
main.bg-paper,
.bg-paper {
  background-color: #f5f3f0 !important;
  background: #f5f3f0 !important;
}

/* Grid positioning utilities */
.row-start-1 { grid-row-start: 1; }
.row-start-2 { grid-row-start: 2; }
.row-start-3 { grid-row-start: 3; }
.row-start-4 { grid-row-start: 4; }

.col-start-1 { grid-column-start: 1; }
.col-start-2 { grid-column-start: 2; }
.col-start-3 { grid-column-start: 3; }
.col-start-4 { grid-column-start: 4; }

/* Flex utilities */
.flex { display: flex; }
.flex-col { flex-direction: column; }
.items-center { align-items: center; }
.justify-center { justify-content: center; }
.justify-end { justify-content: flex-end; }
.justify-between { justify-content: space-between; }

/* Text utilities */
.text-center { text-align: center; }
.text-right { text-align: right; }
.uppercase { text-transform: uppercase; }
.tracking-wide { letter-spacing: 0.025em; }
.leading-tight { line-height: 1.25; }
.leading-none { line-height: 1; }

/* Spacing utilities */
.space-y-sm > * + * { margin-top: var(--space-sm); }
.space-y-md > * + * { margin-top: var(--space-md); }
.space-y-lg > * + * { margin-top: var(--space-lg); }
.mt-md { margin-top: var(--space-md); }
.mb-lg { margin-bottom: var(--space-lg); }

/* Object fit */
.object-cover { object-fit: cover; }

/* Focus styles */
:focus-visible { 
  outline: 2px solid var(--accent); 
  outline-offset: 2px; 
}

/* Smooth transitions */
* {
  transition: color 0.2s ease, background-color 0.2s ease;
}

/* Scrollbar styles */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #1a2ee6;
}

/* Outer frame for all pages */
.site-frame{
  padding: var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
  min-height: 100dvh; /* avoids iOS 100vh bugs */
  border: none;
  outline: none;
  margin: 0;
}

/* Desktop Layout - CSS Grid */
@media (min-width: 1024px){
  :root{
    --edge-fluid: clamp(28px, 6vh, 72px);
    --measure: clamp(38ch, 42vw, 50ch);
  }

  /* Site frame uses the same rhythm on desktop */
  .site-frame{
    padding-block: var(--edge-fluid);
    padding-inline: var(--edge-fluid);
    min-height: 100dvh;
  }

  /* Make the six-cell grid the single source of truth */
  .em{
    display:grid;
    grid-template-columns: minmax(360px,800px) minmax(48px,1fr) var(--measure);
    /* equal, fluid top/bottom spacers; center row hugs content */
    grid-template-rows: minmax(var(--edge-fluid),1fr) max-content minmax(var(--edge-fluid),1fr);
    column-gap: var(--space-lg,32px);
    row-gap: 0;
    min-height: calc(100dvh - 2*var(--edge-fluid));
    align-items: stretch;
  }

  /* Map each slot to its cell + alignment */
  .em [data-id="left-top"]    { grid-column:1; grid-row:1; align-self:center;  justify-self:center; }
  .em [data-id="left-middle"] { grid-column:1; grid-row:2; place-self:center center; }
  .em [data-id="left-bottom"] { grid-column:1; grid-row:3; align-self:stretch;    justify-self:center; }

  .em [data-id="right-top"]    { grid-column:3; grid-row:1; align-self:center;  justify-self:start; }
  .em [data-id="right-middle"] { grid-column:3; grid-row:2; place-self:center start; max-width: var(--measure); }
  .em [data-id="right-bottom"] { grid-column:3; grid-row:3; align-self:center;    justify-self:start; }

  /* Remove the old nested system completely */
  .em [data-id="right-block"]{ all:unset; display:contents; }

  /* Small, surgical margin normalizations so links/headings don't reintroduce spacing */
  @media (min-width:1024px){
    [data-id="right-top"] > *, 
    [data-id="right-bottom"] > *{ margin:0 }

    [data-id="right-middle"] .about-prose{
      margin:0;
    }
    [data-id="right-middle"] .about-prose > :first-child{ margin-top:0 }
    [data-id="right-middle"] .about-prose > :last-child{  margin-bottom:0 }
  }



  /* === Unified size utilities === */
  .fs-logo { font-size: var(--fs-logo); }
  .fs-right { font-size: var(--fs-right); }
  .fs-contact { font-size: var(--fs-contact); }

  /* Families (assumes --font-sans / --font-serif are already defined) */
  .sans { font-family: var(--font-sans); }
  .serif { font-family: var(--font-serif); }

  /* Right-column prose block:
     - The block's root defines the shared size (fs-right).
     - Headlines/links use sans; body text uses serif, BOTH inherit the same size. */
  .about-prose{
    font-size: var(--fs-right);
    line-height: 1.4;
    color: var(--accent, #1c4cff);
    margin: 0;
  }
  .about-prose > *{ margin: 0; }
  .about-prose h1,
  .about-prose h2,
  .about-prose h3,
  .about-prose strong,
  .about-prose a{
    font-family: var(--font-sans);
    font-size: inherit;
    font-weight: 400; /* Fixed: Kaarle & Kumpp only has weight 400 */
    line-height: 1.1;
    text-transform: uppercase;
    letter-spacing: .04em;
  }
  .about-prose p,
  .about-prose em,
  .about-prose i{
    font-family: var(--font-serif);
    font-size: inherit;
    line-height: 1.45;
    font-style: normal;
  }
  .about-prose em,
  .about-prose i{ font-style: italic; }

  /* Right-column canonical sans look - GUARD: weight 400, synthesis none */
  .right-sans,
  [data-id="right-block"] h1,
  [data-id="right-block"] h2,
  [data-id="right-block"] a,
  .nav-right { 
    font-family: var(--font-sans) !important; 
    font-size: var(--fs-right); 
    font-weight: 400 !important; /* Fixed: Kaarle & Kumpp only has weight 400 */
    font-synthesis: none !important; /* Prevent synthetic bold */
    text-transform: uppercase; 
    letter-spacing: .04em;
    line-height: 1.1;
    font-variation-settings: normal;
    font-feature-settings: "liga" 1, "kern" 1;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
  }

  /* Contact line: one shared size, mix families per span */
  .contact-line,
  .contact{
    font-size: var(--fs-contact);
    line-height: 1.1;
    display: flex;
    gap: .35rem;
    flex-wrap: wrap;
    align-items: baseline;
    margin: 0;
    padding: 0;
  }
  .contact__name{ font-family: var(--font-sans); font-weight: 400; /* Fixed: Kaarle & Kumpp only has weight 400 */ }
  .contact__phone{ font-family: var(--font-serif); font-weight:500; }
  .contact__email{ font-family: var(--font-serif); font-weight:500; font-style: italic; text-decoration:none; color:inherit; }


  /* Neutralize space-y utility that adds extra margin-top */
  .about-prose.space-y-sm > * + *,
  .about-prose .space-y-sm > * + *{
    margin-top: 0 !important;
  }

  /* Paragraph rhythm: natural spacing between paragraphs */
  .about-prose p{
    margin: 0 0 1.2em 0 !important;  /* spacing between paragraphs */
    line-height: 1.35 !important;      /* tighter for block reading */
  }
  .about-prose p:last-child{
    margin-bottom: 0 !important;
  }

  /* Headings in the prose block: SANS-SERIF to match nav links */
  .about-prose h1,
  .about-prose .kicker{
    font-family: var(--font-sans) !important;
    font-size: inherit !important;  /* inherit from container (var(--fs-right)) */
    font-weight: 400 !important; /* Fixed: Kaarle & Kumpp only has weight 400 */
    text-transform: uppercase !important;
    letter-spacing: .04em !important;
    line-height: 1.1 !important;
    font-variation-settings: normal !important;
    font-feature-settings: "liga" 1, "kern" 1 !important;
    -webkit-font-smoothing: antialiased !important;
    text-rendering: optimizeLegibility !important;
    margin-top: 0 !important;
    margin-bottom: 1em !important;  /* match paragraph spacing */
  }
  
  /* Force override for any conflicting rules */
  .em [data-id="right-block"] .about-prose h1,
  .em [data-id="right-block"] .about-prose .kicker{
    margin-bottom: 1em !important;
  }
  
  /* Last kicker at bottom: space before it */
  .about-prose .kicker:last-child{
    margin-top: 1em !important;
    margin-bottom: 0 !important;
  }

  
  /* Normalize the logo block so utilities don't add unexpected space */
  .logo{
    margin:0 !important;
    padding:0 !important;
    line-height:1;                 /* tighter, prevents extra line box height */
  }
  .logo .text-center{ margin:0 !important; }

  /* Normalize the contact line wrapper */
  .contact-line,
  .contact{
    margin:0 !important;
    padding:0 !important;
  }

  /* Safety: neutralize any width:100% utilities on the logo wrapper */
  .logo, .contact-line, .left-cell{
    width: auto !important;
    max-width: none !important;
  }

  /* Nav */
  a[href="/works"], a[href="/about"]{
    font-family:var(--font-sans);
    text-transform:uppercase; letter-spacing:.04em;
  }

  /* Visibility gates */
  .desktop-only{ display:contents !important; }
  .mobile-only,.mobile-stack,.mobile-bottom{ display:none !important; }
}

/* Logo styles */
.logo .text-center {
  text-align: center;
  line-height: 1.1;
}

.logo .apple-logo::before {
  content: "\F8FF";
  font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
}

/* === Single mobile block (canonical) === */
@media (max-width: var(--bp-mobile-max)) {
  /* Mobile layout - Flex Stack */
  .em {
    display: block;
  }
  
  .mobile-stack {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }
  
  .mobile-stack .logo { 
    padding-block: clamp(4px, 2vh, 12px); 
  }
  
  .mobile-bottom {
    position: fixed;
    left: 0;
    right: 0;
    bottom: env(safe-area-inset-bottom, 0);
    background: #fff;
    padding: 10px 14px env(safe-area-inset-bottom, 0);
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    box-shadow: none;
    z-index: 1000;
  }
  
  .mobile-nav {
    display: flex;
    justify-content: center;
    gap: var(--space-xl);
  }
  
  .mobile-nav__link {
    text-decoration: none;
    color: inherit;
    font-weight: 500;
  }
  
  /* Mobile visibility gates */
  .desktop-only { display: none !important; }
  .mobile-only { display: contents; }
  
  /* Route-specific rules - About page */
  .route-about .mobile-stack {
    gap: var(--space-md);
  }
  
  .route-about .about-prose p { 
    color: var(--accent); 
  }
  
  .route-about .about-prose em { 
    font-style: italic; 
  }
  
  .route-about .about-prose p:last-of-type { 
    color: var(--accent); 
  }
  
  .route-about .about-contact .contact { 
    flex-direction: column; 
    align-items: flex-start; 
    gap: .25rem; 
  }
  
  .route-about .about-photo img { 
    display: block; 
    width: 100%; 
    max-width: 320px; 
    margin: 0; 
    border: 1px solid rgba(0,0,0,.08); 
  }
  
  .route-about .about-cv a { 
    text-decoration: underline; 
    text-underline-offset: 2px; 
  }

  /* Route-specific rules - Works page */
  .works-page .about-prose {
    line-height: 1.5 !important; /* 1.5 times the normal line height for works page right column */
  }

  /* Client page - shrink-to-fit wrapper for centering */
  .client-page .em [data-id="left-middle"] {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  /* Work card wrapper - shrink to fit content */
  .client-page .work-card {
    width: max-content;
    max-width: 100%;
  }
  
  /* Override stretch-causing styles in ClientGallery */
  .client-page .em [data-id="left-middle"] > div {
    width: auto !important;
    flex: none !important;
  }
}

/* Debug overlay styles */
:root{
  --dbg-gray: #9aa0a6;
  --dbg-frame: #eab30855;          /* amber */
  --dbg-grid: #22c55e33;           /* green */
  --dbg-left: #f59e0b40;           /* orange */
  --dbg-right: #60a5fa2b;          /* blue */
  --dbg-right-pad: #60a5fa33;      /* blue padding */
  --dbg-right-content: #bfdbfe55;  /* blue content */
  --dbg-slot-top: #f472b633;       /* pink */
  --dbg-slot-mid: #a78bfa33;       /* violet */
  --dbg-slot-bot: #34d39933;       /* emerald */
}

/* Stronger debug overlay with .debug-on class */
:root{
  --dbg-frame: #f7d9a6a6;   /* outer frame */
  --dbg-grid:  #cfead2a8;   /* .em grid area */
  --dbg-col:   #8ec5a1a8;   /* columns tint */
  --dbg-slot:  #b7d7f2a8;   /* slot wrappers */
  --dbg-pad:   #a8c5f6a8;   /* right-block padding */
  --dbg-cont:  #cfe0ffcc;   /* content box */
  --dbg-text:  #0b3b75;     /* label text */
  --dbg-dash:  #0b3b75a8;
}

/* Toggle with .debug on <html> */
.debug .site-frame{
  outline: 1px dashed var(--dbg-gray);
  outline-offset: 0;
  background:
    linear-gradient(var(--dbg-frame),var(--dbg-frame)) padding-box,
    transparent;
  background-clip: padding-box;
}

/* Show the desktop grid container */
@media (min-width:1024px){
  .debug .em{
    position: relative;
    outline: 2px dotted var(--dbg-grid);
    background: linear-gradient(var(--dbg-grid),var(--dbg-grid));
    background-clip: content-box;
    border: 3px solid #ff0000; /* Red border for main grid */
  }
  /* Column hints: left(orange) | spacer(gray stripes) | right(blue) */
  /* Stripe the spacer column by tinting the *gap* element using grid-area hack:
     Give the grid gap a visual by placing a pseudo overlay on the em container. */
  .debug .em::before{
    content:"";
    position:absolute; inset:0;
    pointer-events:none;
    background:
      repeating-linear-gradient(
        90deg,
        transparent 0 30%,
        transparent 0 calc(30% + 8px),
        #cbd5e166 calc(30% + 8px) calc(30% + 16px)
      );
    mix-blend-mode: multiply;
    opacity:.35;
  }

  /* LEFT column slots coloring */
  .debug [data-id="left-top"]{   background: var(--dbg-slot-top);   border: 2px solid #00ff00; /* Green border for left column */ }
  .debug [data-id="left-middle"]{background: var(--dbg-slot-mid);   border: 2px solid #00ff00; /* Green border for left column */ }
  .debug [data-id="left-bottom"]{background: var(--dbg-slot-bot);   border: 2px solid #00ff00; /* Green border for left column */ }

  /* RIGHT column: show padding vs content distinctly */
  .debug [data-id="right-block"]{
    position: relative;
    border: 3px solid #0000ff; /* Blue border for right column */
    background:
      linear-gradient(var(--dbg-right-pad),var(--dbg-right-pad)) padding-box,
      linear-gradient(var(--dbg-right-content),var(--dbg-right-content)) content-box;
    background-clip: padding-box, content-box;
  }

  /* Also outline each internal right-block child (top/prose/bottom) */
  .debug [data-id="right-block"] > *{
    outline: 1px dashed #3b82f6;
    background: linear-gradient(#93c5fd2b,#93c5fd2b);
    border: 2px solid #ff00ff; /* Magenta border for right column rows */
  }

  /* Label each slot for quick reading */
  .debug [data-id]::after{
    position:absolute;
    top:4px; left:6px;
    padding:2px 6px;
    font: 11px/1.2 ui-monospace, SFMono-Regular, Menlo, monospace;
    color:#111; background:#fff9;
    border:1px solid #0002; border-radius:4px;
    text-transform:none; letter-spacing:0;
    white-space:nowrap;
    pointer-events:none;
  }
  .debug [data-id="left-top"]::after{ content:"ROW 1 - left-top"; }
  .debug [data-id="left-middle"]::after{ content:"ROW 2 - left-middle"; }
  .debug [data-id="left-bottom"]::after{ content:"ROW 3 - left-bottom"; }
  .debug [data-id="right-top"]::after{ content:"ROW 1 - right-top"; }
  .debug [data-id="right-block"]::after{ content:"ROW 1-3 - right-block (padding=blue tint, content=lighter blue)"; top:-22px; }
  .debug [data-id="right-bottom"]::after{ content:"ROW 3 - right-bottom"; }

  /* Nudge labels if parent is static */
  .debug [data-id]{ position: relative; }

  /* Show grid rows with horizontal lines */
  .debug .em::after{
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    background:
      linear-gradient(0deg, 
        transparent 0,
        transparent calc(33.333% - 1px),
        #ff0000 calc(33.333% - 1px),
        #ff0000 calc(33.333% + 1px),
        transparent calc(33.333% + 1px),
        transparent calc(66.666% - 1px),
        #ff0000 calc(66.666% - 1px),
        #ff0000 calc(66.666% + 1px),
        transparent calc(66.666% + 1px),
        transparent 100%
      );
    z-index: 1;
  }

  /* Show grid columns with vertical lines - override the existing ::before */
  .debug .em::before{
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    background:
      linear-gradient(90deg, 
        transparent 0,
        transparent calc(60% - 1px),
        #00ff00 calc(60% - 1px),
        #00ff00 calc(60% + 1px),
        transparent calc(60% + 1px),
        transparent 100%
      );
    z-index: 1;
  }
}

/* Optional: dashed page edge to visualize .site-frame safe area */
.debug body{
  background:
    linear-gradient(#0000,#0000) padding-box,
    linear-gradient(#0000,#0000) content-box;
}
.debug .site-frame{
  box-shadow: inset 0 0 0 2px #00000010, inset 0 0 0 8px #00000006;
  border-radius: 12px; /* Just to see the frame crisp */
}

/* Stronger debug overlay with .debug-on class */
body.debug-on .site-frame{ 
  outline: 4px solid var(--dbg-frame); 
  outline-offset:-4px; 
  position:relative; 
}

body.debug-on .em{ 
  background: var(--dbg-grid); 
  position:relative; 
}

body.debug-on .em::before{ /* 3 columns tint */
  content:"";
  position:absolute; inset:0;
  background:
    linear-gradient(90deg,
      transparent 0,
      transparent calc(0% + 0px),
      var(--dbg-col) calc(0% + 0px),
      var(--dbg-col) calc(33.333% - 0px),
      transparent calc(33.333% - 0px),
      transparent calc(33.333% + 0px),
      var(--dbg-col) calc(33.333% + 0px),
      var(--dbg-col) calc(66.666% - 0px),
      transparent calc(66.666% - 0px),
      transparent calc(66.666% + 0px),
      var(--dbg-col) calc(66.666% + 0px),
      var(--dbg-col) 100%
    );
  pointer-events:none;
  opacity:.25;
}

body.debug-on [data-id="left-top"],
body.debug-on [data-id="left-middle"],
body.debug-on [data-id="left-bottom"],
body.debug-on [data-id="right-top"],
body.debug-on [data-id="right-block"],
body.debug-on [data-id="right-bottom"]{
  background: var(--dbg-slot);
  position:relative;
}

body.debug-on [data-id="right-block"]{
  box-shadow: inset 0 0 0 16px var(--dbg-pad);
}

body.debug-on [data-id="right-block"] > *{
  background: var(--dbg-cont);
  outline: 2px dashed var(--dbg-dash);
}

/* small top-left label for each slot */
body.debug-on [data-id]::after{
  content: attr(data-id);
  position:absolute; top:-10px; left:-10px;
  font: 600 10px/1.4 ui-sans-serif,system-ui;
  color: var(--dbg-text);
  background:#fff; border:1px solid var(--dbg-dash); padding:2px 4px; border-radius:3px;
}

/* Quick debug aid: center guideline for column 1 */
body.debug-on .em [data-id="left-middle"]::after{
  content:"";
  position:absolute;
  left:50%;
  top:-200vh;
  height:400vh;
  width:0;
  border-left:1px dashed rgba(0,0,0,.25);
  pointer-events:none;
}